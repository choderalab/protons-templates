#!/bin/bash 
#BSUB -J {{ job.title }}
#BSUB -n 1
#BSUB -R rusage[mem=8]
#BSUB -q gpuqueue
#BSUB -R select[gpu_model0=='{{ job.gpu_model|default('GeForceGTX1080Ti') }}']
#BSUB -W  120:00
#BSUB -We 119:30
#BSUB -o %J.stdout
#BSUB -eo %J.stderr
#BSUB -L /bin/bash

# quit on first error
set -e

# Change to working directory used for job submission
cd $LS_SUBCWD
export PATH="/home/rustenburg/miniconda3/bin:$PATH"

# Use the right conda environment
source activate {{ job.conda_environment|default('protons-production') }}

# Launch my program.
module load cuda
python {{ script.name }}

{% if job.resubmission_script %}
# Submit the next job into the queue
bsub < {{ job.resubmission_script }}
{% endif %}
